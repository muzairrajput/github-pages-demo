<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Loading…</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>body{font-family:system-ui,sans-serif;margin:2rem}</style>
</head>
<body>
  <h1>Loading…</h1>
  <p>If you aren’t redirected, check the console (F12) for details.</p>

  <script>
    (function () {
      // Strip trailing slash, split into non-empty segments
      const rawPath = location.pathname.replace(/\/+$/,'');
      const parts = rawPath.split('/').filter(Boolean); // e.g. ["testhtml","en"] or ["repo","testhtml","en"]

      console.log('[router] pathname:', location.pathname, 'parts:', parts);

      if (parts.length >= 2) {
        const locale = parts[parts.length - 1];
        const slug   = parts[parts.length - 2];

        const ok = /^[A-Za-z0-9._-]+$/;
        if (ok.test(slug) && ok.test(locale)) {
          // Keep any repo prefix for project pages: /<repo>/...
          const prefixParts = parts.slice(0, -2); // everything before slug/locale
          const basePrefix = prefixParts.length ? '/' + prefixParts.join('/') : '';

          const file = `${slug}_${locale}.html`;
          const target = `${location.origin}${basePrefix}/${file}`;
          console.log(target);

          console.log('[router] redirecting to', target);
          location.replace(target);
          return;
        } else {
          console.warn('[router] invalid chars in slug/locale', {slug, locale});
        }
      } else {
        console.warn('[router] not enough path parts to route', parts);
      }

      // Fallback UI
      document.body.innerHTML = `
        <h1>Page not found</h1>
        <p>Use a path like <code>/&lt;slug&gt;/&lt;locale&gt;</code>, e.g. <code>/term/en</code>.</p>
      `;
    })();
  </script>
</body>

</html>
